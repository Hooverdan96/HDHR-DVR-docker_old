# This workflow prunes unused images from the GitHub Container Registry (GHCR)
# associated with this repository. It can be triggered manually via the
# "workflow_dispatch" event. The workflow uses a personal access token (PAT)
# with appropriate permissions to delete images from the registry.


---
name: github-cleanup
on:
  schedule:
    - cron: '30 2 1 * *'
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
    inputs:
      dryrun:
        description: dry-run execution, default 'false'
        required: true
        default: false
        type: boolean
env:
  REGISTRY_NAME: ghcr.io
  IMAGE_NAME: hdhr-dvr-docker
  REGISTRY_IMAGE: hooverdan96/hdhr-dvr-docker
jobs:
  clean:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    steps:
      - name: Cleanup ghcr
        uses: quartx-analytics/ghcr-cleaner@v1
        with:
            owner-type: user # for organizations use org
            token: ${{ secrets.DELETE_PACKAGES_TOKEN }}
            delete-untagged: true
            dry-run: ${{ github.event.inputs.dryrun || 'false' }}
